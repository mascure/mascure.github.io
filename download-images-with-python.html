<!DOCTYPE HTML>
<html>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
    <meta name="Keywords" content="blog"/>
    <meta name="Description" content="blog"/>
    <title>Simple</title>
    <link rel="shortcut icon" href="/static/favicon.png"/>
    <link rel="stylesheet" type="text/css" href="/main.css" />
</head>
<body>
<div class="main">
    <div class="header">
    	<ul id="pages">
            <li><a href="/">home</a></li>
            <li><a href="/#/tags">tags</a></li>
            <li><a href="/#/archive">archive</a></li>
    	</ul>
    </div>
	<div class="wrap-header">
	<h1>
    <a href="/" id="title"></a>
	</h1>
	</div>
<div id="md" style="display: none;">
<!-- markdown -->
用python批量下载一个网页中的图片，需要用到扩展库来解析html代码。有三种方法，一是用微软提供的扩展库win32com来操作IE，二是用selenium的webdriver，三是用python自带的HTMLParser解析。win32com可以获得类似js里面的document对象，不过是只读的（文档都没找到）。selenium则提供了Chrome，IE，FireFox等的支持，每种浏览器都有execute_script和find_element_by_xx方法，可以方便的执行js脚本（包括修改元素）和读取html里面的元素。不足是selenium只提供对python2.6和2.7的支持。HTMLParser则是需要自己写个类继承基类，重写解析元素的方法。个人感觉selenium用起来更方便，很容易操作html里的元素。

代码如下：

win32com：

~~~~{python}
#将滚动条滑到底,最多滑动20000像素
#模拟键盘右键，查看多张图片
import sys
import win32com.client,win32api
import urllib.request
import time
import os

def main():
    #获取参数
    url=sys.argv[1]
    #操作IE
    ie=win32com.client.Dispatch("InternetExplorer.Application")
    ie.Navigate(url)
    ie.Visible=True
    last_url=''
    dir_name=''
    while last_url!=url:
        print('\nThe URL is:',url,'\n')
        while ie.ReadyState != 4:    
            time.sleep(1)
        while ie.Document.readyState != "complete": 
            time.sleep(1)
        #滑动滚动条
        win=ie.Document.parentWindow
        lastY=-1;
        for i in range(40):
            win.scrollTo(0,500*i)
            nowY=win.pageYOffset
            if(nowY==lastY):
                break
            lastY=nowY
            time.sleep(0.4)
        print('Document load state:',ie.Document.readyState)
        doc=ie.Document
        #第一次需要创建目录
        if(dir_name==''):
            root_dir='E:\\img'
            dir_name=root_dir+'\\'+doc.title
            dir_name=dir_name.replace('|','-')
            if(os.path.exists(root_dir)!=True):
                os.mkdir(root_dir)
            if(os.path.exists(dir_name)!=True):
                os.mkdir(dir_name)
        all_image=doc.images
        print('共有',all_image.length,'张图片')
        count=0;
        for img in all_image:
            if(img.id=='b_img'):
                count=count+1
                print(count,img.src)
                time.sleep(1)
                img_file=urllib.request.urlopen(img.src)
                byte=img_file.read()
                print(count,'donwload complete!','-'*10,'size:','{:.3}'.format(byte.__len__()/1024),'KB')
                if(byte.__len__()>7000):
                    file_name=img.src.replace('/','_')
                    file_name=file_name.replace(':','_')
                    end=file_name.__len__()
                    if(file_name.rfind('!')!=-1):
                        end=file_name.rfind('!')
                    if(file_name.rfind('?')!=-1):
                        end=file_name.rfind('?')
                    file_name=file_name[:end]
                    write_file=open(dir_name+'\\'+file_name,'wb')
                    write_file.write(byte)
                    write_file.close()
                    print(count,file_name,'complete!')
        #下一张
        last_url=url
        win32api.keybd_event(39,0)
        time.sleep(1)
        url=ie.Document.url
        print(last_url,url)
    #ie.Quit()
if __name__ == '__main__':
    main()
~~~~
selenium:
~~~~{python}
# -*- coding: cp936 -*-
import sys
import urllib
import time
import os
from selenium import webdriver

def main():
    #获取参数
    url=sys.argv[1]
    #操作IE
    driver=webdriver.Chrome()
    driver.get(url)
    driver.execute_script("window.scrollTo(0, document.body.scrollHeight);")
    #创建目录
    dir_name=driver.find_element_by_tag_name('title').text
    print dir_name
    root_dir='E:\\img'
    dir_name=root_dir+'\\'+dir_name
    dir_name=dir_name.replace('|','-')
    if(os.path.exists(root_dir)!=True):
        os.mkdir(root_dir)
    if(os.path.exists(dir_name)!=True):
        os.mkdir(dir_name)
    images=driver.find_elements_by_tag_name('img')
    count=0
    for image in images:
        count=count+1
        image_url=str(image.get_attribute('src'))
        img_file=urllib.urlopen(image_url)
        byte=img_file.read()
        print count,'donwload complete!','-'*10,'size:',byte.__len__()/1024,'KB'
        if(byte.__len__()>7000):
            file_name=image_url.replace('/','_')
            file_name=file_name.replace(':','_')
            end=file_name.__len__()
            if(file_name.rfind('!')!=-1):
                end=file_name.rfind('!')
            if(file_name.rfind('?')!=-1):
                end=file_name.rfind('?')
            file_name=file_name[:end]
            write_file=open(dir_name+'\\'+file_name,'wb')
            write_file.write(byte)
            write_file.close()
            print count,file_name,'complete!'

    driver.quit()
if __name__ == '__main__':
    main()
~~~~

HTMLParser:
~~~~{python}
# import modules used here -- sys is a very standard one
import sys
import urllib.request
# Gather our code in a main() function

from html.parser import HTMLParser
class MyHTMLParser(HTMLParser):
    def handle_starttag(self,tag,attrs):
        if(tag=='img'):
            for attr in attrs:
                if(attr[0]=='src'):
                    img_file=urllib.request.urlopen(attr[1])
                    byte=img_file.read()
                    #文件大于1000b则生成文件,添加计数，下载多少图片，显示html代码
                    if(byte.__len__()>1000):
                        file_name=attr[1].replace('/','_')
                        file_name=file_name.replace(':','_')
                        end=file_name.__len__()
                        if(file_name.rfind('!')!=-1):
                            end=file_name.rfind('!')
                        if(file_name.rfind('?')!=-1):
                            end=file_name.rfind('?')
                        file_name=file_name[:end]
##                        print(file_name)
                        write_file=open('E:\\img\\'+file_name,'wb')
                        write_file.write(byte)
                        write_file.close()

def main():
    #获取参数
    url=sys.argv[1]
    print('\nThe URL is:',url,'\n')
    #读取url所指向的资源
    html_file=urllib.request.urlopen(url)
    byte_content=html_file.read()
    #将html网页保存起来
    url_file=open('E:\\img\\html\\result.htm','wb')
    url_file.write(byte_content)
    url_file.close()
    #从字节转换为字符串
    s=str(byte_content, encoding = "utf-8")
    #print(s)
    #bytes.decode(html_file.read())
    parser=MyHTMLParser(strict=False)
    parser.feed(s)
# Standard boilerplate to call the main() function to begin
# the program.
if __name__ == '__main__':
    main()
~~~~

<!-- markdown end -->
</div>
<div class="entry" id="main">
<!-- content -->
<p>用python批量下载一个网页中的图片，需要用到扩展库来解析html代码。有三种方法，一是用微软提供的扩展库win32com来操作IE，二是用selenium的webdriver，三是用python自带的HTMLParser解析。win32com可以获得类似js里面的document对象，不过是只读的（文档都没找到）。selenium则提供了Chrome，IE，FireFox等的支持，每种浏览器都有execute<em>script和find</em>element<em>by</em>xx方法，可以方便的执行js脚本（包括修改元素）和读取html里面的元素。不足是selenium只提供对python2.6和2.7的支持。HTMLParser则是需要自己写个类继承基类，重写解析元素的方法。个人感觉selenium用起来更方便，很容易操作html里的元素。</p>

<p>代码如下：</p>

<p>win32com：</p>

<pre class=" language-python"><code class=" language-python"><span class="token comment" spellcheck="true">#将滚动条滑到底,最多滑动20000像素
</span><span class="token comment" spellcheck="true">#模拟键盘右键，查看多张图片
</span><span class="token keyword">import</span> sys
<span class="token keyword">import</span> win32com<span class="token punctuation">.</span>client<span class="token punctuation">,</span>win32api
<span class="token keyword">import</span> urllib<span class="token punctuation">.</span>request
<span class="token keyword">import</span> time
<span class="token keyword">import</span> os

<span class="token keyword">def</span> main<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token comment" spellcheck="true">#获取参数
</span>    url<span class="token operator">=</span>sys<span class="token punctuation">.</span>argv<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span>
    <span class="token comment" spellcheck="true">#操作IE
</span>    ie<span class="token operator">=</span>win32com<span class="token punctuation">.</span>client<span class="token punctuation">.</span>Dispatch<span class="token punctuation">(</span><span class="token string">"InternetExplorer.Application"</span><span class="token punctuation">)</span>
    ie<span class="token punctuation">.</span>Navigate<span class="token punctuation">(</span>url<span class="token punctuation">)</span>
    ie<span class="token punctuation">.</span>Visible<span class="token operator">=</span><span class="token boolean">True</span>
    last_url<span class="token operator">=</span><span class="token string">''</span>
    dir_name<span class="token operator">=</span><span class="token string">''</span>
    <span class="token keyword">while</span> last_url<span class="token operator">!</span><span class="token operator">=</span>url<span class="token punctuation">:</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'\nThe URL is:'</span><span class="token punctuation">,</span>url<span class="token punctuation">,</span><span class="token string">'\n'</span><span class="token punctuation">)</span>
        <span class="token keyword">while</span> ie<span class="token punctuation">.</span>ReadyState <span class="token operator">!</span><span class="token operator">=</span> <span class="token number">4</span><span class="token punctuation">:</span>    
            time<span class="token punctuation">.</span>sleep<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>
        <span class="token keyword">while</span> ie<span class="token punctuation">.</span>Document<span class="token punctuation">.</span>readyState <span class="token operator">!</span><span class="token operator">=</span> <span class="token string">"complete"</span><span class="token punctuation">:</span> 
            time<span class="token punctuation">.</span>sleep<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>
        <span class="token comment" spellcheck="true">#滑动滚动条
</span>        win<span class="token operator">=</span>ie<span class="token punctuation">.</span>Document<span class="token punctuation">.</span>parentWindow
        lastY<span class="token operator">=</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span>
        <span class="token keyword">for</span> i <span class="token keyword">in</span> range<span class="token punctuation">(</span><span class="token number">40</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
            win<span class="token punctuation">.</span>scrollTo<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">500</span><span class="token operator">*</span>i<span class="token punctuation">)</span>
            nowY<span class="token operator">=</span>win<span class="token punctuation">.</span>pageYOffset
            <span class="token keyword">if</span><span class="token punctuation">(</span>nowY<span class="token operator">==</span>lastY<span class="token punctuation">)</span><span class="token punctuation">:</span>
                <span class="token keyword">break</span>
            lastY<span class="token operator">=</span>nowY
            time<span class="token punctuation">.</span>sleep<span class="token punctuation">(</span><span class="token number">0.4</span><span class="token punctuation">)</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'Document load state:'</span><span class="token punctuation">,</span>ie<span class="token punctuation">.</span>Document<span class="token punctuation">.</span>readyState<span class="token punctuation">)</span>
        doc<span class="token operator">=</span>ie<span class="token punctuation">.</span>Document
        <span class="token comment" spellcheck="true">#第一次需要创建目录
</span>        <span class="token keyword">if</span><span class="token punctuation">(</span>dir_name<span class="token operator">==</span><span class="token string">''</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
            root_dir<span class="token operator">=</span><span class="token string">'E:\\img'</span>
            dir_name<span class="token operator">=</span>root_dir<span class="token operator">+</span><span class="token string">'\\'</span><span class="token operator">+</span>doc<span class="token punctuation">.</span>title
            dir_name<span class="token operator">=</span>dir_name<span class="token punctuation">.</span>replace<span class="token punctuation">(</span><span class="token string">'|'</span><span class="token punctuation">,</span><span class="token string">'-'</span><span class="token punctuation">)</span>
            <span class="token keyword">if</span><span class="token punctuation">(</span>os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>exists<span class="token punctuation">(</span>root_dir<span class="token punctuation">)</span><span class="token operator">!</span><span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
                os<span class="token punctuation">.</span>mkdir<span class="token punctuation">(</span>root_dir<span class="token punctuation">)</span>
            <span class="token keyword">if</span><span class="token punctuation">(</span>os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>exists<span class="token punctuation">(</span>dir_name<span class="token punctuation">)</span><span class="token operator">!</span><span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
                os<span class="token punctuation">.</span>mkdir<span class="token punctuation">(</span>dir_name<span class="token punctuation">)</span>
        all_image<span class="token operator">=</span>doc<span class="token punctuation">.</span>images
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'共有'</span><span class="token punctuation">,</span>all_image<span class="token punctuation">.</span>length<span class="token punctuation">,</span><span class="token string">'张图片'</span><span class="token punctuation">)</span>
        count<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>
        <span class="token keyword">for</span> img <span class="token keyword">in</span> all_image<span class="token punctuation">:</span>
            <span class="token keyword">if</span><span class="token punctuation">(</span>img<span class="token punctuation">.</span>id<span class="token operator">==</span><span class="token string">'b_img'</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
                count<span class="token operator">=</span>count<span class="token operator">+</span><span class="token number">1</span>
                <span class="token keyword">print</span><span class="token punctuation">(</span>count<span class="token punctuation">,</span>img<span class="token punctuation">.</span>src<span class="token punctuation">)</span>
                time<span class="token punctuation">.</span>sleep<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>
                img_file<span class="token operator">=</span>urllib<span class="token punctuation">.</span>request<span class="token punctuation">.</span>urlopen<span class="token punctuation">(</span>img<span class="token punctuation">.</span>src<span class="token punctuation">)</span>
                byte<span class="token operator">=</span>img_file<span class="token punctuation">.</span>read<span class="token punctuation">(</span><span class="token punctuation">)</span>
                <span class="token keyword">print</span><span class="token punctuation">(</span>count<span class="token punctuation">,</span><span class="token string">'donwload complete!'</span><span class="token punctuation">,</span><span class="token string">'-'</span><span class="token operator">*</span><span class="token number">10</span><span class="token punctuation">,</span><span class="token string">'size:'</span><span class="token punctuation">,</span><span class="token string">'{:.3}'</span><span class="token punctuation">.</span>format<span class="token punctuation">(</span>byte<span class="token punctuation">.</span>__len__<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">/</span><span class="token number">1024</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token string">'KB'</span><span class="token punctuation">)</span>
                <span class="token keyword">if</span><span class="token punctuation">(</span>byte<span class="token punctuation">.</span>__len__<span class="token punctuation">(</span><span class="token punctuation">)</span>&gt;<span class="token number">7000</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
                    file_name<span class="token operator">=</span>img<span class="token punctuation">.</span>src<span class="token punctuation">.</span>replace<span class="token punctuation">(</span><span class="token string">'/'</span><span class="token punctuation">,</span><span class="token string">'_'</span><span class="token punctuation">)</span>
                    file_name<span class="token operator">=</span>file_name<span class="token punctuation">.</span>replace<span class="token punctuation">(</span><span class="token string">':'</span><span class="token punctuation">,</span><span class="token string">'_'</span><span class="token punctuation">)</span>
                    end<span class="token operator">=</span>file_name<span class="token punctuation">.</span>__len__<span class="token punctuation">(</span><span class="token punctuation">)</span>
                    <span class="token keyword">if</span><span class="token punctuation">(</span>file_name<span class="token punctuation">.</span>rfind<span class="token punctuation">(</span><span class="token string">'!'</span><span class="token punctuation">)</span><span class="token operator">!</span><span class="token operator">=</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
                        end<span class="token operator">=</span>file_name<span class="token punctuation">.</span>rfind<span class="token punctuation">(</span><span class="token string">'!'</span><span class="token punctuation">)</span>
                    <span class="token keyword">if</span><span class="token punctuation">(</span>file_name<span class="token punctuation">.</span>rfind<span class="token punctuation">(</span><span class="token string">'?'</span><span class="token punctuation">)</span><span class="token operator">!</span><span class="token operator">=</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
                        end<span class="token operator">=</span>file_name<span class="token punctuation">.</span>rfind<span class="token punctuation">(</span><span class="token string">'?'</span><span class="token punctuation">)</span>
                    file_name<span class="token operator">=</span>file_name<span class="token punctuation">[</span><span class="token punctuation">:</span>end<span class="token punctuation">]</span>
                    write_file<span class="token operator">=</span>open<span class="token punctuation">(</span>dir_name<span class="token operator">+</span><span class="token string">'\\'</span><span class="token operator">+</span>file_name<span class="token punctuation">,</span><span class="token string">'wb'</span><span class="token punctuation">)</span>
                    write_file<span class="token punctuation">.</span>write<span class="token punctuation">(</span>byte<span class="token punctuation">)</span>
                    write_file<span class="token punctuation">.</span>close<span class="token punctuation">(</span><span class="token punctuation">)</span>
                    <span class="token keyword">print</span><span class="token punctuation">(</span>count<span class="token punctuation">,</span>file_name<span class="token punctuation">,</span><span class="token string">'complete!'</span><span class="token punctuation">)</span>
        <span class="token comment" spellcheck="true">#下一张
</span>        last_url<span class="token operator">=</span>url
        win32api<span class="token punctuation">.</span>keybd_event<span class="token punctuation">(</span><span class="token number">39</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">)</span>
        time<span class="token punctuation">.</span>sleep<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>
        url<span class="token operator">=</span>ie<span class="token punctuation">.</span>Document<span class="token punctuation">.</span>url
        <span class="token keyword">print</span><span class="token punctuation">(</span>last_url<span class="token punctuation">,</span>url<span class="token punctuation">)</span>
    <span class="token comment" spellcheck="true">#ie.Quit()
</span><span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">'__main__'</span><span class="token punctuation">:</span>
    main<span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre>selenium:
<pre class=" language-python"><code class=" language-python"><span class="token comment" spellcheck="true"># -*- coding: cp936 -*-
</span><span class="token keyword">import</span> sys
<span class="token keyword">import</span> urllib
<span class="token keyword">import</span> time
<span class="token keyword">import</span> os
<span class="token keyword">from</span> selenium <span class="token keyword">import</span> webdriver

<span class="token keyword">def</span> main<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token comment" spellcheck="true">#获取参数
</span>    url<span class="token operator">=</span>sys<span class="token punctuation">.</span>argv<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span>
    <span class="token comment" spellcheck="true">#操作IE
</span>    driver<span class="token operator">=</span>webdriver<span class="token punctuation">.</span>Chrome<span class="token punctuation">(</span><span class="token punctuation">)</span>
    driver<span class="token punctuation">.</span>get<span class="token punctuation">(</span>url<span class="token punctuation">)</span>
    driver<span class="token punctuation">.</span>execute_script<span class="token punctuation">(</span><span class="token string">"window.scrollTo(0, document.body.scrollHeight);"</span><span class="token punctuation">)</span>
    <span class="token comment" spellcheck="true">#创建目录
</span>    dir_name<span class="token operator">=</span>driver<span class="token punctuation">.</span>find_element_by_tag_name<span class="token punctuation">(</span><span class="token string">'title'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>text
    <span class="token keyword">print</span> dir_name
    root_dir<span class="token operator">=</span><span class="token string">'E:\\img'</span>
    dir_name<span class="token operator">=</span>root_dir<span class="token operator">+</span><span class="token string">'\\'</span><span class="token operator">+</span>dir_name
    dir_name<span class="token operator">=</span>dir_name<span class="token punctuation">.</span>replace<span class="token punctuation">(</span><span class="token string">'|'</span><span class="token punctuation">,</span><span class="token string">'-'</span><span class="token punctuation">)</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span>os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>exists<span class="token punctuation">(</span>root_dir<span class="token punctuation">)</span><span class="token operator">!</span><span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        os<span class="token punctuation">.</span>mkdir<span class="token punctuation">(</span>root_dir<span class="token punctuation">)</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span>os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>exists<span class="token punctuation">(</span>dir_name<span class="token punctuation">)</span><span class="token operator">!</span><span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        os<span class="token punctuation">.</span>mkdir<span class="token punctuation">(</span>dir_name<span class="token punctuation">)</span>
    images<span class="token operator">=</span>driver<span class="token punctuation">.</span>find_elements_by_tag_name<span class="token punctuation">(</span><span class="token string">'img'</span><span class="token punctuation">)</span>
    count<span class="token operator">=</span><span class="token number">0</span>
    <span class="token keyword">for</span> image <span class="token keyword">in</span> images<span class="token punctuation">:</span>
        count<span class="token operator">=</span>count<span class="token operator">+</span><span class="token number">1</span>
        image_url<span class="token operator">=</span>str<span class="token punctuation">(</span>image<span class="token punctuation">.</span>get_attribute<span class="token punctuation">(</span><span class="token string">'src'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        img_file<span class="token operator">=</span>urllib<span class="token punctuation">.</span>urlopen<span class="token punctuation">(</span>image_url<span class="token punctuation">)</span>
        byte<span class="token operator">=</span>img_file<span class="token punctuation">.</span>read<span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token keyword">print</span> count<span class="token punctuation">,</span><span class="token string">'donwload complete!'</span><span class="token punctuation">,</span><span class="token string">'-'</span><span class="token operator">*</span><span class="token number">10</span><span class="token punctuation">,</span><span class="token string">'size:'</span><span class="token punctuation">,</span>byte<span class="token punctuation">.</span>__len__<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">/</span><span class="token number">1024</span><span class="token punctuation">,</span><span class="token string">'KB'</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span>byte<span class="token punctuation">.</span>__len__<span class="token punctuation">(</span><span class="token punctuation">)</span>&gt;<span class="token number">7000</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
            file_name<span class="token operator">=</span>image_url<span class="token punctuation">.</span>replace<span class="token punctuation">(</span><span class="token string">'/'</span><span class="token punctuation">,</span><span class="token string">'_'</span><span class="token punctuation">)</span>
            file_name<span class="token operator">=</span>file_name<span class="token punctuation">.</span>replace<span class="token punctuation">(</span><span class="token string">':'</span><span class="token punctuation">,</span><span class="token string">'_'</span><span class="token punctuation">)</span>
            end<span class="token operator">=</span>file_name<span class="token punctuation">.</span>__len__<span class="token punctuation">(</span><span class="token punctuation">)</span>
            <span class="token keyword">if</span><span class="token punctuation">(</span>file_name<span class="token punctuation">.</span>rfind<span class="token punctuation">(</span><span class="token string">'!'</span><span class="token punctuation">)</span><span class="token operator">!</span><span class="token operator">=</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
                end<span class="token operator">=</span>file_name<span class="token punctuation">.</span>rfind<span class="token punctuation">(</span><span class="token string">'!'</span><span class="token punctuation">)</span>
            <span class="token keyword">if</span><span class="token punctuation">(</span>file_name<span class="token punctuation">.</span>rfind<span class="token punctuation">(</span><span class="token string">'?'</span><span class="token punctuation">)</span><span class="token operator">!</span><span class="token operator">=</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
                end<span class="token operator">=</span>file_name<span class="token punctuation">.</span>rfind<span class="token punctuation">(</span><span class="token string">'?'</span><span class="token punctuation">)</span>
            file_name<span class="token operator">=</span>file_name<span class="token punctuation">[</span><span class="token punctuation">:</span>end<span class="token punctuation">]</span>
            write_file<span class="token operator">=</span>open<span class="token punctuation">(</span>dir_name<span class="token operator">+</span><span class="token string">'\\'</span><span class="token operator">+</span>file_name<span class="token punctuation">,</span><span class="token string">'wb'</span><span class="token punctuation">)</span>
            write_file<span class="token punctuation">.</span>write<span class="token punctuation">(</span>byte<span class="token punctuation">)</span>
            write_file<span class="token punctuation">.</span>close<span class="token punctuation">(</span><span class="token punctuation">)</span>
            <span class="token keyword">print</span> count<span class="token punctuation">,</span>file_name<span class="token punctuation">,</span><span class="token string">'complete!'</span>

    driver<span class="token punctuation">.</span>quit<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">'__main__'</span><span class="token punctuation">:</span>
    main<span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre>

<p>HTMLParser:</p>

<pre class=" language-python"><code class=" language-python"><span class="token comment" spellcheck="true"># import modules used here -- sys is a very standard one
</span><span class="token keyword">import</span> sys
<span class="token keyword">import</span> urllib<span class="token punctuation">.</span>request
<span class="token comment" spellcheck="true"># Gather our code in a main() function
</span>
<span class="token keyword">from</span> html<span class="token punctuation">.</span>parser <span class="token keyword">import</span> HTMLParser
<span class="token keyword">class</span> MyHTMLParser<span class="token punctuation">(</span>HTMLParser<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">def</span> handle_starttag<span class="token punctuation">(</span>self<span class="token punctuation">,</span>tag<span class="token punctuation">,</span>attrs<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span>tag<span class="token operator">==</span><span class="token string">'img'</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
            <span class="token keyword">for</span> attr <span class="token keyword">in</span> attrs<span class="token punctuation">:</span>
                <span class="token keyword">if</span><span class="token punctuation">(</span>attr<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token operator">==</span><span class="token string">'src'</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
                    img_file<span class="token operator">=</span>urllib<span class="token punctuation">.</span>request<span class="token punctuation">.</span>urlopen<span class="token punctuation">(</span>attr<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
                    byte<span class="token operator">=</span>img_file<span class="token punctuation">.</span>read<span class="token punctuation">(</span><span class="token punctuation">)</span>
                    <span class="token comment" spellcheck="true">#文件大于1000b则生成文件,添加计数，下载多少图片，显示html代码
</span>                    <span class="token keyword">if</span><span class="token punctuation">(</span>byte<span class="token punctuation">.</span>__len__<span class="token punctuation">(</span><span class="token punctuation">)</span>&gt;<span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
                        file_name<span class="token operator">=</span>attr<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">.</span>replace<span class="token punctuation">(</span><span class="token string">'/'</span><span class="token punctuation">,</span><span class="token string">'_'</span><span class="token punctuation">)</span>
                        file_name<span class="token operator">=</span>file_name<span class="token punctuation">.</span>replace<span class="token punctuation">(</span><span class="token string">':'</span><span class="token punctuation">,</span><span class="token string">'_'</span><span class="token punctuation">)</span>
                        end<span class="token operator">=</span>file_name<span class="token punctuation">.</span>__len__<span class="token punctuation">(</span><span class="token punctuation">)</span>
                        <span class="token keyword">if</span><span class="token punctuation">(</span>file_name<span class="token punctuation">.</span>rfind<span class="token punctuation">(</span><span class="token string">'!'</span><span class="token punctuation">)</span><span class="token operator">!</span><span class="token operator">=</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
                            end<span class="token operator">=</span>file_name<span class="token punctuation">.</span>rfind<span class="token punctuation">(</span><span class="token string">'!'</span><span class="token punctuation">)</span>
                        <span class="token keyword">if</span><span class="token punctuation">(</span>file_name<span class="token punctuation">.</span>rfind<span class="token punctuation">(</span><span class="token string">'?'</span><span class="token punctuation">)</span><span class="token operator">!</span><span class="token operator">=</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
                            end<span class="token operator">=</span>file_name<span class="token punctuation">.</span>rfind<span class="token punctuation">(</span><span class="token string">'?'</span><span class="token punctuation">)</span>
                        file_name<span class="token operator">=</span>file_name<span class="token punctuation">[</span><span class="token punctuation">:</span>end<span class="token punctuation">]</span>
<span class="token comment" spellcheck="true">##                        print(file_name)
</span>                        write_file<span class="token operator">=</span>open<span class="token punctuation">(</span><span class="token string">'E:\\img\\'</span><span class="token operator">+</span>file_name<span class="token punctuation">,</span><span class="token string">'wb'</span><span class="token punctuation">)</span>
                        write_file<span class="token punctuation">.</span>write<span class="token punctuation">(</span>byte<span class="token punctuation">)</span>
                        write_file<span class="token punctuation">.</span>close<span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token keyword">def</span> main<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token comment" spellcheck="true">#获取参数
</span>    url<span class="token operator">=</span>sys<span class="token punctuation">.</span>argv<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'\nThe URL is:'</span><span class="token punctuation">,</span>url<span class="token punctuation">,</span><span class="token string">'\n'</span><span class="token punctuation">)</span>
    <span class="token comment" spellcheck="true">#读取url所指向的资源
</span>    html_file<span class="token operator">=</span>urllib<span class="token punctuation">.</span>request<span class="token punctuation">.</span>urlopen<span class="token punctuation">(</span>url<span class="token punctuation">)</span>
    byte_content<span class="token operator">=</span>html_file<span class="token punctuation">.</span>read<span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token comment" spellcheck="true">#将html网页保存起来
</span>    url_file<span class="token operator">=</span>open<span class="token punctuation">(</span><span class="token string">'E:\\img\\html\\result.htm'</span><span class="token punctuation">,</span><span class="token string">'wb'</span><span class="token punctuation">)</span>
    url_file<span class="token punctuation">.</span>write<span class="token punctuation">(</span>byte_content<span class="token punctuation">)</span>
    url_file<span class="token punctuation">.</span>close<span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token comment" spellcheck="true">#从字节转换为字符串
</span>    s<span class="token operator">=</span>str<span class="token punctuation">(</span>byte_content<span class="token punctuation">,</span> encoding <span class="token operator">=</span> <span class="token string">"utf-8"</span><span class="token punctuation">)</span>
    <span class="token comment" spellcheck="true">#print(s)
</span>    <span class="token comment" spellcheck="true">#bytes.decode(html_file.read())
</span>    parser<span class="token operator">=</span>MyHTMLParser<span class="token punctuation">(</span>strict<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">)</span>
    parser<span class="token number">.feed</span><span class="token punctuation">(</span>s<span class="token punctuation">)</span>
<span class="token comment" spellcheck="true"># Standard boilerplate to call the main() function to begin
</span><span class="token comment" spellcheck="true"># the program.
</span><span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">'__main__'</span><span class="token punctuation">:</span>
    main<span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre>
<!-- content end -->
</div>
<br>
<br>
    <div id="disqus_thread"></div>
	<div class="footer">
		<p>© Copyright 2014 by isnowfy, Designed by isnowfy</p>
	</div>
</div>
<script src="main.js"></script>
<script id="content" type="text/mustache">
    <h1>{{title}}</h1>
    <div class="tag">
    {{date}}
    {{#tags}}
    <a href="/#/tag/{{name}}">#{{name}}</a>
    {{/tags}}
    </div>
</script>
<script id="pagesTemplate" type="text/mustache">
    {{#pages}}
    <li>
        <a href="{{path}}">{{title}}</a>
    </li>
    {{/pages}}
</script>
<script>
$(document).ready(function() {
    $.ajax({
        url: "main.json",
        type: "GET",
        dataType: "json",
        success: function(data) {
            $("#title").html(data.name);
            var pagesTemplate = Hogan.compile($("#pagesTemplate").html());
            var pagesHtml = pagesTemplate.render({"pages": data.pages});
            $("#pages").append(pagesHtml);
            //path
            var path = "download-images-with-python.html";
            //path end
            var now = 0;
            for (var i = 0; i < data.posts.length; ++i)
                if (path == data.posts[i].path)
                    now = i;
            var post = data.posts[now];
            var tmp = post.tags.split(" ");
            var tags = [];
            for (var i = 0; i < tmp.length; ++i)
                if (tmp[i].length > 0)
                    tags.push({"name": tmp[i]});
            var contentTemplate = Hogan.compile($("#content").html());
            var contentHtml = contentTemplate.render({"title": post.title, "tags": tags, "date": post.date});
            $("#main").prepend(contentHtml);
            if (data.disqus_shortname.length > 0) {
                var disqus_shortname = data.disqus_shortname;
                (function() {
                    var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
                    dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
                    (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
                })();
            }
        }
    });
});
</script>
<script src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
<script type="text/x-mathjax-config">
    MathJax.Hub.Config({tex2jax: {inlineMath: [['$','$'], ["\\(", "\\)"]], processEscapes: true}});
</script>
</body>
</html>
